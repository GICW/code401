{"ast":null,"code":"var _jsxFileName = \"/home/qxie/401/class-34/solution/src/Context/Auth/Auth.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport cookie from 'react-cookies';\nimport jwt_decode from 'jwt-decode';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/React.createContext();\nfunction AuthProvider({\n  children\n}) {\n  _s();\n  let [error, setError] = useState(null);\n  let [isLoggedIn, setIsLoggedIn] = useState(false);\n  let [user, setUser] = useState({});\n  const can = capability => {\n    var _user$capabilities;\n    return user === null || user === void 0 ? void 0 : (_user$capabilities = user.capabilities) === null || _user$capabilities === void 0 ? void 0 : _user$capabilities.includes(capability);\n  };\n  const login = async (username, password) => {\n    const config = {\n      baseURL: 'https://api-js401.herokuapp.com',\n      url: '/signin',\n      method: 'post',\n      auth: {\n        username,\n        password\n      }\n    };\n    const response = await axios(config);\n    const {\n      token\n    } = response.data;\n    // console.log('response', response.data);\n\n    if (token) {\n      try {\n        _validateToken(token);\n        // console.log('I am Here', {isLoggedIn, user});\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n  const _validateToken = token => {\n    try {\n      let validUser = jwt_decode(token);\n      // console.log({validUser})\n      if (validUser) {\n        setUser(validUser);\n        // console.log({inside: {validUser}})\n        // console.log({user})\n        setIsLoggedIn(true);\n        // console.log('isLoggedIn:', isLoggedIn);\n        // cookie.save('auth', token);\n      }\n    } catch (e) {\n      setIsLoggedIn(false);\n      setError(e);\n    }\n  };\n  const logout = () => {\n    setUser({});\n    setIsLoggedIn(false);\n    setError(null);\n    cookie.remove('auth');\n  };\n  useEffect(() => {\n    let token = cookie.load('auth');\n    if (token) {\n      _validateToken(token);\n    }\n  }, []);\n  const values = {\n    error,\n    isLoggedIn,\n    user,\n    can,\n    login,\n    logout\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: values,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"xDyZ1JdTU5CnxOkkWCcb9TWoJ4s=\");\n_c = AuthProvider;\nexport default AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","useState","useEffect","cookie","jwt_decode","axios","jsxDEV","_jsxDEV","AuthContext","createContext","AuthProvider","children","_s","error","setError","isLoggedIn","setIsLoggedIn","user","setUser","can","capability","_user$capabilities","capabilities","includes","login","username","password","config","baseURL","url","method","auth","response","token","data","_validateToken","e","console","validUser","logout","remove","load","values","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/qxie/401/class-34/solution/src/Context/Auth/Auth.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport cookie from 'react-cookies';\nimport jwt_decode from 'jwt-decode';\nimport axios from 'axios';\n\nexport const AuthContext = React.createContext();\n\nfunction AuthProvider({ children }) {\n\n  let [error, setError] = useState(null);\n  let [isLoggedIn, setIsLoggedIn] = useState(false);\n  let [user, setUser] = useState({});\n\n  const can = (capability) => {\n    return user?.capabilities?.includes(capability); \n  }\n\n  const login = async (username, password) => {\n\n    const config = {\n      baseURL: 'https://api-js401.herokuapp.com',\n      url: '/signin',\n      method: 'post',\n      auth: {\n        username,\n        password,\n      }\n    }\n\n    const response = await axios(config);\n    const { token } = response.data;\n    // console.log('response', response.data);\n\n    if (token) {\n      try {\n        _validateToken(token);\n        // console.log('I am Here', {isLoggedIn, user});\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }\n\n  const _validateToken = (token) => {\n    try {\n      let validUser = jwt_decode(token);\n      // console.log({validUser})\n      if (validUser) {\n        setUser(validUser);\n        // console.log({inside: {validUser}})\n        // console.log({user})\n        setIsLoggedIn(true);\n        // console.log('isLoggedIn:', isLoggedIn);\n        // cookie.save('auth', token);\n      }\n    } catch (e) {\n      setIsLoggedIn(false);\n      setError(e);\n    }\n  }\n\n  const logout = () => {\n    setUser({});\n    setIsLoggedIn(false);\n    setError(null);\n    cookie.remove('auth');\n  }\n\n  useEffect(() => {\n    let token = cookie.load('auth');\n    if(token){\n      _validateToken(token)\n    }\n  }, [])\n\n\n  const values = {\n    error,\n    isLoggedIn,\n    user,\n    can,\n    login,\n    logout,\n  }\n\n  return (\n    <AuthContext.Provider value={values}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport default AuthProvider;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}