{"ast":null,"code":"var _jsxFileName = \"/home/qxie/401/class-33/solution/src/Context/Auth/Auth.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport cookie from 'react-cookies';\nimport jwt_decode from 'jwt-decode';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/React.createContext();\nconst testUsers = {\n  admin: {\n    username: 'admin',\n    password: 'ADMIN',\n    email: 'admin@fakeuser.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTM1OGI1NzAzOTM2MDAxODAyYThlMSIsImNhcGFiaWxpdGllcyI6WyJjcmVhdGUiLCJ1cGRhdGUiLCJyZWFkIiwiZGVsZXRlIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU5MDY2NTQ5LCJleHAiOjE2NTkwNzAxNDl9.efsLBIA9wqw6EFx9YuS166MjWP_7vQQkM2wrRVOLlV4'\n  },\n  editor: {\n    username: 'editor',\n    password: 'EDITOR',\n    email: 'editor@fakeuser.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZjk5MzNjZTQ5MDAxODlmMzhiYSIsImNhcGFiaWxpdGllcyI6WyJjcmVhdGUiLCJ1cGRhdGUiLCJyZWFkIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4NTY5LCJleHAiOjE2NTg5MTIxNjl9.073ppQCHbplYN9befn8JElcP4zgFX6TEe_ARUQZc0KU'\n  },\n  writer: {\n    username: 'writer',\n    password: 'WRITER',\n    email: 'writer@fakeuser.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZmUxMzNjZTQ5MDAxODlmMzhiZCIsImNhcGFiaWxpdGllcyI6W10sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4NjQxLCJleHAiOjE2NTg5MTIyNDF9.AUOPHDRV6z8urvmgUOyRmCYUwfeScmGdb4ztvjPMlos'\n  },\n  user: {\n    username: 'user',\n    password: 'USER',\n    email: 'user@fakeuser.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBmMGZjMzNjZTQ5MDAxODlmMzhjMCIsImNhcGFiaWxpdGllcyI6WyJyZWFkIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4OTI0LCJleHAiOjE2NTg5MTI1MjR9.t7c7k2LbaTxsdfYjx_WC3QiP4MycU8sZryVyXQqJQH'\n  }\n};\nfunction AuthProvider({\n  children\n}) {\n  _s();\n  let [error, setError] = useState(null);\n  let [isLoggedIn, setIsLoggedIn] = useState(false);\n  let [user, setUser] = useState({});\n  const can = capability => {\n    var _user$capabilities;\n    return user === null || user === void 0 ? void 0 : (_user$capabilities = user.capabilities) === null || _user$capabilities === void 0 ? void 0 : _user$capabilities.includes(capability);\n  };\n  const login = async (username, password) => {\n    let authCredentials = testUsers[username];\n    if (authCredentials && authCredentials.password === password) {\n      try {\n        _validateToken(authCredentials.token);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n  const _validateToken = token => {\n    try {\n      let validUser = jwt_decode(token);\n      if (validUser) {\n        setUser(validUser);\n        setIsLoggedIn(true);\n        cookie.save('auth', token);\n      }\n    } catch (e) {\n      setIsLoggedIn(false);\n      setError(e);\n    }\n  };\n  const logout = () => {\n    setUser({});\n    setIsLoggedIn(false);\n    setError(null);\n    cookie.remove('auth');\n  };\n  useEffect(() => {\n    let token = cookie.load('auth');\n    if (token) {\n      _validateToken(token);\n    }\n  }, []);\n  const values = {\n    error,\n    isLoggedIn,\n    user,\n    can,\n    login,\n    logout\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: values,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"xDyZ1JdTU5CnxOkkWCcb9TWoJ4s=\");\n_c = AuthProvider;\nexport default AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","useState","useEffect","cookie","jwt_decode","jsxDEV","_jsxDEV","AuthContext","createContext","testUsers","admin","username","password","email","token","editor","writer","user","AuthProvider","children","_s","error","setError","isLoggedIn","setIsLoggedIn","setUser","can","capability","_user$capabilities","capabilities","includes","login","authCredentials","_validateToken","e","console","validUser","save","logout","remove","load","values","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/qxie/401/class-33/solution/src/Context/Auth/Auth.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport cookie from 'react-cookies';\nimport jwt_decode from 'jwt-decode';\n\nexport const AuthContext = React.createContext();\n\nconst testUsers = {\n  admin: {\n    username: 'admin',\n    password: 'ADMIN',\n    email: 'admin@fakeuser.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTM1OGI1NzAzOTM2MDAxODAyYThlMSIsImNhcGFiaWxpdGllcyI6WyJjcmVhdGUiLCJ1cGRhdGUiLCJyZWFkIiwiZGVsZXRlIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU5MDY2NTQ5LCJleHAiOjE2NTkwNzAxNDl9.efsLBIA9wqw6EFx9YuS166MjWP_7vQQkM2wrRVOLlV4',\n  },\n  editor: {\n    username: 'editor',\n    password: 'EDITOR',\n    email: 'editor@fakeuser.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZjk5MzNjZTQ5MDAxODlmMzhiYSIsImNhcGFiaWxpdGllcyI6WyJjcmVhdGUiLCJ1cGRhdGUiLCJyZWFkIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4NTY5LCJleHAiOjE2NTg5MTIxNjl9.073ppQCHbplYN9befn8JElcP4zgFX6TEe_ARUQZc0KU',\n  },\n  writer: {\n    username: 'writer',\n    password: 'WRITER',\n    email: 'writer@fakeuser.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZmUxMzNjZTQ5MDAxODlmMzhiZCIsImNhcGFiaWxpdGllcyI6W10sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4NjQxLCJleHAiOjE2NTg5MTIyNDF9.AUOPHDRV6z8urvmgUOyRmCYUwfeScmGdb4ztvjPMlos',\n  },\n  user: {\n    username: 'user',\n    password: 'USER',\n    email: 'user@fakeuser.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBmMGZjMzNjZTQ5MDAxODlmMzhjMCIsImNhcGFiaWxpdGllcyI6WyJyZWFkIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4OTI0LCJleHAiOjE2NTg5MTI1MjR9.t7c7k2LbaTxsdfYjx_WC3QiP4MycU8sZryVyXQqJQH',\n  }\n\n}\n\nfunction AuthProvider({ children }) {\n\n  let [error, setError] = useState(null);\n  let [isLoggedIn, setIsLoggedIn] = useState(false);\n  let [user, setUser] = useState({});\n\n  const can = (capability) => {\n    return user?.capabilities?.includes(capability); \n  }\n\n  const login = async (username, password) => {\n    let authCredentials = testUsers[username]; \n    if (authCredentials && authCredentials.password === password) {\n      try {\n        _validateToken(authCredentials.token);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }\n\n  const _validateToken = (token) => {\n    try {\n      let validUser = jwt_decode(token);\n      if (validUser) {\n        setUser(validUser);\n        setIsLoggedIn(true);\n        cookie.save('auth', token);\n      }\n    } catch (e) {\n      setIsLoggedIn(false);\n      setError(e);\n    }\n  }\n\n  const logout = () => {\n    setUser({});\n    setIsLoggedIn(false);\n    setError(null);\n    cookie.remove('auth');\n  }\n\n  useEffect(() => {\n    let token = cookie.load('auth');\n    if(token){\n      _validateToken(token)\n    }\n  }, [])\n\n\n  const values = {\n    error,\n    isLoggedIn,\n    user,\n    can,\n    login,\n    logout,\n  }\n\n  return (\n    <AuthContext.Provider value={values}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport default AuthProvider;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}